#include <stdio.h>
#include <math.h>
#include <stdlib.h>

static float degree2radian(float angle)
{
	return (M_PI * angle) / 180.0;
}


static float radian2degree(float radian)
{
	return 180.0 * radian / M_PI;
}


/// find closest angle index in the pattern_T 
/// \param angle partial groove angle (start from 6 o'clock 0.0 ~ 360, clockwise)
/// \param ptn_t_list pattern_T (must be sorted in ascending order)
/// \param record_count record count
/// \return index
static int pgrv_angle_to_ptn_index(float angle, float *ptn_t_list, int record_count)
{
	int i, start_idx;
	float radian;
	float min_diff, diff;

	radian = degree2radian(angle);
	start_idx = record_count * ( radian / (2 * M_PI) ) ;

	if ( start_idx <= 0 || start_idx >= record_count ) {
		return 0;
	}

	min_diff = fabs( radian - ptn_t_list[start_idx]);

	if ( radian > ptn_t_list[start_idx] ) {
		for ( i = start_idx + 1; i < record_count ; i++ ) {
			diff = fabs( radian - ptn_t_list[i]);
			if ( diff >= min_diff) {
				return i-1;
			}
			min_diff = diff;
		}
		return record_count -1;
	} else {
		for ( i = start_idx - 1; i >= 0 ; i -- ) {
			diff = fabs( radian - ptn_t_list[i]);
			if ( diff >= min_diff) {
				return i+1;
			}
		}
	}
	return 0;
}


int main(int argc, char *argv[])
{
	extern float ptn_list[];
	int start_idx;
	float angle = 0.0;
	float radian;

	if ( argc < 2 ) { 
		printf("enter angle : ");
		scanf("%f", &angle);
	} else {
		angle = atof(argv[1]);
	}
	radian = degree2radian(angle);

	start_idx = pgrv_angle_to_ptn_index(angle, ptn_list, 1440);

	printf("%.2f, %.4f -> start_idx = %d\n", angle, radian, start_idx);
	printf("ptn[idx] = %.4f, ptn[idx-1] = %.4f, ptn[idx+1] = %.4f\n", ptn_list[start_idx], ptn_list[(start_idx - 1 + 1440) % 1440], ptn_list[ (start_idx + 1) % 1440 ]);
	printf("angle[idx] = %.2f, angle[idx-1] = %.2f, angle[idx+1] = %.2f\n", radian2degree(ptn_list[start_idx]), radian2degree(ptn_list[(start_idx - 1 + 1440) % 1440]), radian2degree(ptn_list[ (start_idx + 1) % 1440 ]));
	return 0;
}




float ptn_list[] = 
	{  
		// sample frame
	
		// angle
	0.0000, 0.0042, 0.0087, 0.0129, 0.0174, 0.0218, 0.0260, 0.0303, 
	0.0348, 0.0390, 0.0433, 0.0476, 0.0519, 0.0562, 0.0606, 0.0649, 
	0.0692, 0.0736, 0.0778, 0.0822, 0.0865, 0.0908, 0.0951, 0.0995, 
	0.1039, 0.1081, 0.1124, 0.1167, 0.1210, 0.1254, 0.1297, 0.1340, 
	0.1384, 0.1428, 0.1471, 0.1515, 0.1557, 0.1601, 0.1644, 0.1688, 
	0.1731, 0.1775, 0.1819, 0.1862, 0.1906, 0.1950, 0.1993, 0.2037, 
	0.2081, 0.2124, 0.2168, 0.2211, 0.2254, 0.2298, 0.2342, 0.2384, 
	0.2427, 0.2470, 0.2514, 0.2557, 0.2601, 0.2644, 0.2687, 0.2730, 
	0.2773, 0.2816, 0.2859, 0.2903, 0.2946, 0.2989, 0.3032, 0.3076, 
	0.3120, 0.3163, 0.3206, 0.3249, 0.3292, 0.3335, 0.3378, 0.3422, 
	0.3465, 0.3508, 0.3551, 0.3595, 0.3638, 0.3682, 0.3725, 0.3768, 
	0.3813, 0.3856, 0.3899, 0.3944, 0.3986, 0.4030, 0.4073, 0.4116, 
	0.4160, 0.4203, 0.4246, 0.4290, 0.4333, 0.4377, 0.4420, 0.4465, 
	0.4508, 0.4551, 0.4594, 0.4638, 0.4681, 0.4725, 0.4768, 0.4812, 
	0.4856, 0.4900, 0.4943, 0.4987, 0.5031, 0.5074, 0.5119, 0.5162, 
	0.5205, 0.5248, 0.5291, 0.5335, 0.5378, 0.5421, 0.5464, 0.5508, 
	0.5551, 0.5594, 0.5638, 0.5681, 0.5726, 0.5769, 0.5812, 0.5855, 
	0.5899, 0.5942, 0.5985, 0.6029, 0.6072, 0.6115, 0.6159, 0.6202, 
	0.6245, 0.6290, 0.6333, 0.6376, 0.6419, 0.6463, 0.6506, 0.6550, 
	0.6595, 0.6638, 0.6681, 0.6725, 0.6768, 0.6812, 0.6856, 0.6899, 
	0.6943, 0.6987, 0.7030, 0.7074, 0.7117, 0.7161, 0.7204, 0.7249, 
	0.7292, 0.7335, 0.7379, 0.7422, 0.7466, 0.7509, 0.7554, 0.7597, 
	0.7640, 0.7684, 0.7727, 0.7771, 0.7815, 0.7858, 0.7902, 0.7946, 
	0.7990, 0.8033, 0.8077, 0.8121, 0.8165, 0.8208, 0.8252, 0.8296, 
	0.8339, 0.8384, 0.8427, 0.8470, 0.8514, 0.8558, 0.8601, 0.8646, 
	0.8689, 0.8733, 0.8776, 0.8820, 0.8865, 0.8908, 0.8951, 0.8995, 
	0.9039, 0.9083, 0.9127, 0.9171, 0.9215, 0.9259, 0.9303, 0.9347, 
	0.9391, 0.9435, 0.9479, 0.9523, 0.9567, 0.9611, 0.9655, 0.9699, 
	0.9743, 0.9787, 0.9831, 0.9875, 0.9919, 0.9963, 1.0008, 1.0052, 
	1.0095, 1.0139, 1.0183, 1.0227, 1.0271, 1.0315, 1.0360, 1.0404, 
	1.0447, 1.0491, 1.0534, 1.0578, 1.0622, 1.0666, 1.0710, 1.0753, 
	1.0798, 1.0842, 1.0885, 1.0928, 1.0972, 1.1016, 1.1059, 1.1103, 
	1.1147, 1.1190, 1.1234, 1.1279, 1.1323, 1.1366, 1.1409, 1.1453, 
	1.1497, 1.1540, 1.1584, 1.1628, 1.1672, 1.1715, 1.1759, 1.1804, 
	1.1848, 1.1891, 1.1934, 1.1978, 1.2021, 1.2065, 1.2109, 1.2152, 
	1.2196, 1.2239, 1.2283, 1.2328, 1.2371, 1.2415, 1.2458, 1.2501, 
	1.2545, 1.2588, 1.2632, 1.2675, 1.2719, 1.2763, 1.2806, 1.2850, 
	1.2893, 1.2937, 1.2980, 1.3025, 1.3069, 1.3112, 1.3155, 1.3198, 
	1.3242, 1.3286, 1.3329, 1.3373, 1.3417, 1.3460, 1.3504, 1.3549, 
	1.3592, 1.3636, 1.3679, 1.3722, 1.3766, 1.3809, 1.3853, 1.3897, 
	1.3940, 1.3984, 1.4027, 1.4071, 1.4115, 1.4158, 1.4203, 1.4246, 
	1.4290, 1.4333, 1.4376, 1.4419, 1.4463, 1.4506, 1.4550, 1.4594, 
	1.4637, 1.4681, 1.4725, 1.4768, 1.4812, 1.4857, 1.4900, 1.4943, 
	1.4987, 1.5030, 1.5074, 1.5118, 1.5161, 1.5205, 1.5249, 1.5293, 
	1.5338, 1.5381, 1.5425, 1.5468, 1.5512, 1.5556, 1.5600, 1.5644, 
	1.5687, 1.5731, 1.5776, 1.5820, 1.5863, 1.5907, 1.5950, 1.5994, 
	1.6038, 1.6082, 1.6126, 1.6171, 1.6215, 1.6258, 1.6302, 1.6346, 
	1.6390, 1.6434, 1.6478, 1.6523, 1.6567, 1.6611, 1.6655, 1.6699, 
	1.6743, 1.6787, 1.6832, 1.6875, 1.6919, 1.6962, 1.7005, 1.7048, 
	1.7091, 1.7135, 1.7179, 1.7222, 1.7266, 1.7310, 1.7354, 1.7398, 
	1.7443, 1.7487, 1.7531, 1.7575, 1.7619, 1.7663, 1.7709, 1.7752, 
	1.7796, 1.7841, 1.7885, 1.7930, 1.7974, 1.8019, 1.8064, 1.8109, 
	1.8154, 1.8199, 1.8244, 1.8289, 1.8334, 1.8378, 1.8423, 1.8468, 
	1.8513, 1.8557, 1.8601, 1.8646, 1.8690, 1.8734, 1.8779, 1.8823, 
	1.8867, 1.8911, 1.8955, 1.8999, 1.9043, 1.9088, 1.9131, 1.9175, 
	1.9219, 1.9263, 1.9307, 1.9351, 1.9395, 1.9440, 1.9483, 1.9526, 
	1.9570, 1.9614, 1.9658, 1.9702, 1.9746, 1.9790, 1.9835, 1.9878, 
	1.9922, 1.9966, 2.0011, 2.0054, 2.0098, 2.0142, 2.0186, 2.0230, 
	2.0274, 2.0318, 2.0362, 2.0406, 2.0450, 2.0494, 2.0539, 2.0583, 
	2.0627, 2.0671, 2.0715, 2.0758, 2.0802, 2.0845, 2.0889, 2.0934, 
	2.0978, 2.1022, 2.1066, 2.1110, 2.1152, 2.1196, 2.1240, 2.1284, 
	2.1328, 2.1373, 2.1417, 2.1461, 2.1503, 2.1547, 2.1591, 2.1635, 
	2.1679, 2.1722, 2.1766, 2.1810, 2.1854, 2.1898, 2.1942, 2.1986, 
	2.2028, 2.2072, 2.2116, 2.2160, 2.2203, 2.2247, 2.2291, 2.2335, 
	2.2379, 2.2423, 2.2465, 2.2509, 2.2553, 2.2597, 2.2640, 2.2683, 
	2.2727, 2.2770, 2.2814, 2.2857, 2.2901, 2.2946, 2.2988, 2.3032, 
	2.3076, 2.3120, 2.3164, 2.3206, 2.3250, 2.3293, 2.3337, 2.3380, 
	2.3424, 2.3468, 2.3511, 2.3555, 2.3598, 2.3643, 2.3685, 2.3729, 
	2.3773, 2.3817, 2.3859, 2.3903, 2.3947, 2.3990, 2.4034, 2.4077, 
	2.4121, 2.4165, 2.4208, 2.4252, 2.4296, 2.4340, 2.4382, 2.4426, 
	2.4470, 2.4514, 2.4556, 2.4600, 2.4644, 2.4686, 2.4730, 2.4773, 
	2.4817, 2.4860, 2.4904, 2.4947, 2.4991, 2.5035, 2.5078, 2.5121, 
	2.5165, 2.5209, 2.5251, 2.5295, 2.5339, 2.5381, 2.5425, 2.5469, 
	2.5513, 2.5555, 2.5599, 2.5642, 2.5686, 2.5729, 2.5773, 2.5816, 
	2.5860, 2.5903, 2.5947, 2.5990, 2.6034, 2.6078, 2.6120, 2.6164, 
	2.6208, 2.6252, 2.6294, 2.6338, 2.6382, 2.6425, 2.6469, 2.6512, 
	2.6556, 2.6600, 2.6643, 2.6687, 2.6730, 2.6775, 2.6817, 2.6861, 
	2.6905, 2.6947, 2.6991, 2.7035, 2.7077, 2.7121, 2.7165, 2.7207, 
	2.7251, 2.7294, 2.7337, 2.7381, 2.7424, 2.7468, 2.7511, 2.7555, 
	2.7599, 2.7642, 2.7686, 2.7730, 2.7774, 2.7818, 2.7860, 2.7904, 
	2.7948, 2.7990, 2.8034, 2.8076, 2.8120, 2.8163, 2.8206, 2.8250, 
	2.8293, 2.8336, 2.8379, 2.8423, 2.8466, 2.8509, 2.8553, 2.8596, 
	2.8640, 2.8683, 2.8726, 2.8770, 2.8813, 2.8857, 2.8901, 2.8945, 
	2.8987, 2.9031, 2.9075, 2.9119, 2.9161, 2.9205, 2.9249, 2.9292, 
	2.9336, 2.9379, 2.9423, 2.9466, 2.9509, 2.9553, 2.9596, 2.9640, 
	2.9684, 2.9726, 2.9769, 2.9812, 2.9856, 2.9900, 2.9942, 2.9986, 
	3.0030, 3.0072, 3.0116, 3.0158, 3.0202, 3.0246, 3.0288, 3.0332, 
	3.0374, 3.0418, 3.0462, 3.0504, 3.0548, 3.0590, 3.0634, 3.0677, 
	3.0720, 3.0764, 3.0807, 3.0850, 3.0894, 3.0937, 3.0981, 3.1024, 
	3.1068, 3.1111, 3.1155, 3.1198, 3.1243, 3.1285, 3.1329, 3.1373, 
	3.1417, 3.1460, 3.1503, 3.1547, 3.1591, 3.1634, 3.1678, 3.1721, 
	3.1765, 3.1808, 3.1851, 3.1895, 3.1938, 3.1981, 3.2024, 3.2067, 
	3.2111, 3.2154, 3.2197, 3.2240, 3.2283, 3.2328, 3.2370, 3.2414, 
	3.2456, 3.2500, 3.2544, 3.2586, 3.2630, 3.2672, 3.2716, 3.2760, 
	3.2802, 3.2846, 3.2890, 3.2932, 3.2976, 3.3018, 3.3062, 3.3105, 
	3.3148, 3.3191, 3.3234, 3.3278, 3.3321, 3.3364, 3.3407, 3.3451, 
	3.3494, 3.3538, 3.3581, 3.3625, 3.3668, 3.3712, 3.3755, 3.3799, 
	3.3843, 3.3887, 3.3931, 3.3973, 3.4017, 3.4060, 3.4104, 3.4147, 
	3.4190, 3.4234, 3.4277, 3.4320, 3.4364, 3.4407, 3.4450, 3.4493, 
	3.4537, 3.4580, 3.4623, 3.4666, 3.4710, 3.4753, 3.4796, 3.4839, 
	3.4883, 3.4926, 3.4969, 3.5012, 3.5056, 3.5099, 3.5142, 3.5186, 
	3.5230, 3.5272, 3.5316, 3.5360, 3.5404, 3.5446, 3.5490, 3.5533, 
	3.5576, 3.5620, 3.5663, 3.5707, 3.5750, 3.5793, 3.5837, 3.5880, 
	3.5923, 3.5967, 3.6010, 3.6054, 3.6097, 3.6141, 3.6184, 3.6229, 
	3.6273, 3.6315, 3.6359, 3.6403, 3.6446, 3.6490, 3.6533, 3.6577, 
	3.6620, 3.6664, 3.6707, 3.6751, 3.6794, 3.6837, 3.6881, 3.6924, 
	3.6967, 3.7012, 3.7056, 3.7098, 3.7142, 3.7185, 3.7229, 3.7273, 
	3.7316, 3.7360, 3.7403, 3.7447, 3.7490, 3.7534, 3.7577, 3.7620, 
	3.7664, 3.7707, 3.7751, 3.7795, 3.7839, 3.7881, 3.7925, 3.7968, 
	3.8011, 3.8055, 3.8098, 3.8142, 3.8185, 3.8229, 3.8272, 3.8315, 
	3.8359, 3.8402, 3.8446, 3.8489, 3.8533, 3.8576, 3.8620, 3.8664, 
	3.8708, 3.8751, 3.8795, 3.8839, 3.8883, 3.8926, 3.8970, 3.9014, 
	3.9059, 3.9101, 3.9145, 3.9189, 3.9232, 3.9276, 3.9320, 3.9363, 
	3.9407, 3.9451, 3.9494, 3.9538, 3.9582, 3.9625, 3.9670, 3.9713, 
	3.9756, 3.9800, 3.9844, 3.9887, 3.9931, 3.9975, 4.0018, 4.0062, 
	4.0106, 4.0149, 4.0194, 4.0237, 4.0281, 4.0324, 4.0369, 4.0412, 
	4.0455, 4.0499, 4.0543, 4.0587, 4.0631, 4.0675, 4.0718, 4.0762, 
	4.0806, 4.0850, 4.0894, 4.0938, 4.0981, 4.1026, 4.1069, 4.1114, 
	4.1157, 4.1201, 4.1245, 4.1289, 4.1332, 4.1377, 4.1420, 4.1465, 
	4.1508, 4.1552, 4.1596, 4.1640, 4.1684, 4.1728, 4.1772, 4.1816, 
	4.1861, 4.1904, 4.1949, 4.1993, 4.2037, 4.2081, 4.2125, 4.2170, 
	4.2214, 4.2258, 4.2302, 4.2346, 4.2390, 4.2434, 4.2479, 4.2523, 
	4.2567, 4.2611, 4.2655, 4.2701, 4.2744, 4.2788, 4.2832, 4.2876, 
	4.2920, 4.2964, 4.3010, 4.3053, 4.3097, 4.3141, 4.3185, 4.3229, 
	4.3273, 4.3317, 4.3361, 4.3406, 4.3449, 4.3494, 4.3538, 4.3582, 
	4.3626, 4.3670, 4.3715, 4.3759, 4.3803, 4.3847, 4.3891, 4.3935, 
	4.3979, 4.4024, 4.4068, 4.4112, 4.4156, 4.4200, 4.4244, 4.4288, 
	4.4333, 4.4376, 4.4421, 4.4465, 4.4509, 4.4553, 4.4597, 4.4642, 
	4.4685, 4.4730, 4.4772, 4.4816, 4.4860, 4.4904, 4.4948, 4.4993, 
	4.5036, 4.5081, 4.5123, 4.5167, 4.5211, 4.5255, 4.5299, 4.5343, 
	4.5387, 4.5432, 4.5476, 4.5520, 4.5564, 4.5608, 4.5652, 4.5696, 
	4.5741, 4.5784, 4.5829, 4.5872, 4.5915, 4.5959, 4.6003, 4.6047, 
	4.6092, 4.6135, 4.6180, 4.6223, 4.6268, 4.6311, 4.6356, 4.6399, 
	4.6444, 4.6487, 4.6531, 4.6574, 4.6619, 4.6662, 4.6707, 4.6750, 
	4.6795, 4.6838, 4.6881, 4.6925, 4.6970, 4.7013, 4.7058, 4.7101, 
	4.7144, 4.7188, 4.7232, 4.7276, 4.7321, 4.7364, 4.7407, 4.7451, 
	4.7495, 4.7539, 4.7582, 4.7627, 4.7670, 4.7713, 4.7757, 4.7802, 
	4.7844, 4.7888, 4.7932, 4.7975, 4.8020, 4.8062, 4.8106, 4.8150, 
	4.8193, 4.8238, 4.8280, 4.8324, 4.8368, 4.8411, 4.8455, 4.8498, 
	4.8543, 4.8586, 4.8629, 4.8673, 4.8716, 4.8761, 4.8804, 4.8847, 
	4.8891, 4.8934, 4.8979, 4.9022, 4.9065, 4.9109, 4.9152, 4.9196, 
	4.9239, 4.9284, 4.9326, 4.9370, 4.9414, 4.9457, 4.9500, 4.9544, 
	4.9587, 4.9632, 4.9674, 4.9718, 4.9762, 4.9805, 4.9849, 4.9892, 
	4.9937, 4.9980, 5.0023, 5.0067, 5.0110, 5.0155, 5.0197, 5.0241, 
	5.0285, 5.0328, 5.0371, 5.0415, 5.0458, 5.0502, 5.0545, 5.0590, 
	5.0633, 5.0676, 5.0720, 5.0764, 5.0808, 5.0851, 5.0896, 5.0938, 
	5.0982, 5.1026, 5.1069, 5.1112, 5.1156, 5.1199, 5.1243, 5.1286, 
	5.1329, 5.1373, 5.1416, 5.1461, 5.1503, 5.1547, 5.1591, 5.1634, 
	5.1679, 5.1722, 5.1765, 5.1809, 5.1852, 5.1896, 5.1939, 5.1984, 
	5.2026, 5.2070, 5.2114, 5.2157, 5.2200, 5.2244, 5.2287, 5.2332, 
	5.2375, 5.2420, 5.2462, 5.2506, 5.2550, 5.2595, 5.2638, 5.2683, 
	5.2725, 5.2769, 5.2813, 5.2857, 5.2901, 5.2944, 5.2988, 5.3031, 
	5.3076, 5.3119, 5.3164, 5.3207, 5.3252, 5.3295, 5.3339, 5.3383, 
	5.3427, 5.3471, 5.3515, 5.3561, 5.3604, 5.3647, 5.3691, 5.3736, 
	5.3779, 5.3824, 5.3867, 5.3910, 5.3954, 5.3998, 5.4042, 5.4086, 
	5.4130, 5.4175, 5.4218, 5.4263, 5.4305, 5.4349, 5.4393, 5.4436, 
	5.4481, 5.4523, 5.4567, 5.4610, 5.4654, 5.4697, 5.4741, 5.4784, 
	5.4828, 5.4872, 5.4916, 5.4959, 5.5004, 5.5047, 5.5092, 5.5135, 
	5.5178, 5.5222, 5.5267, 5.5309, 5.5353, 5.5397, 5.5440, 5.5485, 
	5.5528, 5.5573, 5.5615, 5.5659, 5.5703, 5.5748, 5.5791, 5.5836, 
	5.5879, 5.5924, 5.5967, 5.6011, 5.6054, 5.6098, 5.6142, 5.6185, 
	5.6229, 5.6272, 5.6317, 5.6359, 5.6403, 5.6447, 5.6490, 5.6535, 
	5.6577, 5.6621, 5.6665, 5.6708, 5.6752, 5.6795, 5.6840, 5.6882, 
	5.6926, 5.6970, 5.7012, 5.7056, 5.7100, 5.7142, 5.7186, 5.7230, 
	5.7272, 5.7316, 5.7360, 5.7403, 5.7446, 5.7490, 5.7534, 5.7577, 
	5.7621, 5.7665, 5.7708, 5.7753, 5.7796, 5.7839, 5.7883, 5.7926, 
	5.7969, 5.8013, 5.8056, 5.8099, 5.8143, 5.8186, 5.8229, 5.8273, 
	5.8316, 5.8359, 5.8403, 5.8446, 5.8490, 5.8534, 5.8578, 5.8621, 
	5.8664, 5.8708, 5.8752, 5.8796, 5.8839, 5.8882, 5.8926, 5.8970, 
	5.9014, 5.9057, 5.9100, 5.9143, 5.9187, 5.9230, 5.9273, 5.9317, 
	5.9361, 5.9403, 5.9446, 5.9491, 5.9533, 5.9576, 5.9619, 5.9663, 
	5.9706, 5.9749, 5.9793, 5.9836, 5.9879, 5.9923, 5.9966, 6.0009, 
	6.0053, 6.0096, 6.0139, 6.0183, 6.0226, 6.0269, 6.0313, 6.0356, 
	6.0399, 6.0443, 6.0486, 6.0529, 6.0573, 6.0616, 6.0660, 6.0703, 
	6.0748, 6.0790, 6.0833, 6.0878, 6.0921, 6.0964, 6.1008, 6.1051, 
	6.1096, 6.1138, 6.1182, 6.1226, 6.1269, 6.1313, 6.1356, 6.1401, 
	6.1443, 6.1487, 6.1531, 6.1574, 6.1617, 6.1661, 6.1704, 6.1749, 
	6.1791, 6.1834, 6.1879, 6.1921, 6.1964, 6.2009, 6.2051, 6.2094, 
	6.2138, 6.2181, 6.2224, 6.2267, 6.2311, 6.2354, 6.2397, 6.2440, 
	6.2484, 6.2527, 6.2570, 6.2613, 6.2657, 6.2700, 6.2744, 6.2788, 
	};
